<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ì–æ–≤–æ—Ä–∏ ‚Äî –ú–∞—Ä–∏–æ –±–µ–∂–∏—Ç!</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Courier New', monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background-image: linear-gradient(#87CEEB 0%, #87CEEB 70%, #228B22 70%, #006400 100%);
    }

    canvas {
      border: 4px solid #4B2E2B;
      image-rendering: pixelated;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    #instructions {
      margin-bottom: 10px;
      text-align: center;
      color: #111;
      font-size: 20px;
      text-shadow: 1px 1px 2px white;
    }

    #status {
      margin-top: 15px;
      font-size: 18px;
      color: #111;
      background: rgba(255,255,255,0.8);
      padding: 8px 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div id="instructions">
    <h1>üéÆ –ì–æ–≤–æ—Ä–∏ ‚Äî –ú–∞—Ä–∏–æ –±–µ–∂–∏—Ç –∏ –ø—Ä—ã–≥–∞–µ—Ç!</h1>
    <p>–†–∞–∑—Ä–µ—à–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω –∏ –≥–æ–≤–æ—Ä–∏—Ç–µ ‚Äî –ú–∞—Ä–∏–æ –ø–æ–±–µ–∂–∏—Ç!</p>
  </div>

  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <div id="status">–û–∂–∏–¥–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞...</div>

  <script>
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const statusText = document.getElementById("status");

    const GRAVITY = 0.5;
    const JUMP_FORCE = -10;
    const GROUND = canvas.height - 50;
    const MARIO_WIDTH = 30;
    const MARIO_HEIGHT = 40;

    let stepPhase = 0; // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–æ–≥

    // –ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π
    let mario = {
      x: 100,
      y: GROUND - MARIO_HEIGHT,
      vy: 0,
      onGround: true,
      isSpeaking: false
    };

    // –£—Ä–æ–≤–µ–Ω—å
    let platforms = [];
    let camera = { x: 0 };
    let lastPlatformX = 0;

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
    function generatePlatform(x) {
      const width = 60 + Math.random() * 140;
      return { x, y: GROUND, width, height: 20 };
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è
    function initLevel() {
      platforms = [];
      lastPlatformX = 0;
      for (let i = 0; i < 15; i++) {
        const p = generatePlatform(lastPlatformX);
        platforms.push(p);
        lastPlatformX = p.x + p.width + 50 + Math.random() * 200;
      }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
    function addPlatforms() {
      while (lastPlatformX < camera.x + canvas.width * 2) {
        const p = generatePlatform(lastPlatformX);
        platforms.push(p);
        lastPlatformX = p.x + p.width + 50 + Math.random() * 200;
      }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ú–∞—Ä–∏–æ (–ø–∏–∫—Å–µ–ª—å-–∞—Ä—Ç)
    function drawMario(x, y) {
      const legOffset = mario.isSpeaking && mario.onGround ? Math.sin(stepPhase) * 3 : 0;
      stepPhase += 0.3;

      // –ö—Ä–∞—Å–Ω–∞—è —à–ª—è–ø–∞
      ctx.fillStyle = "#FF0000";
      ctx.fillRect(x, y, MARIO_WIDTH, 10);
      ctx.fillRect(x - 5, y + 10, MARIO_WIDTH + 10, 5);

      // –õ–∏—Ü–æ (–∫–æ–∂–∞)
      ctx.fillStyle = "#FFA07A";
      ctx.fillRect(x, y + 10, MARIO_WIDTH, 25);

      // –ì–ª–∞–∑–∞
      ctx.fillStyle = "white";
      ctx.fillRect(x + 8, y + 15, 5, 5);
      ctx.fillRect(x + 18, y + 15, 5, 5);
      ctx.fillStyle = "black";
      ctx.fillRect(x + 10, y + 16, 2, 2);
      ctx.fillRect(x + 20, y + 16, 2, 2);

      // –£—Å—ã
      ctx.fillStyle = "#000";
      ctx.fillRect(x + 5, y + 20, 20, 2);
      ctx.fillRect(x + 5, y + 22, 15, 1);
      ctx.fillRect(x + 10, y + 22, 15, 1);

      // –†–æ—Ç (–æ—Ç–∫—Ä—ã—Ç –ø—Ä–∏ —Ä–µ—á–∏)
      if (mario.isSpeaking) {
        ctx.fillStyle = "black";
        ctx.fillRect(x + 13, y + 28, 6, 4);
      }

      // –†—É–∫–∏
      ctx.fillStyle = "#FFA07A";
      ctx.fillRect(x - 3, y + 15, 5, 10);
      ctx.fillRect(x + MARIO_WIDTH - 2, y + 15, 5, 10);

      // –°–∏–Ω—è—è —Ä—É–±–∞—à–∫–∞
      ctx.fillStyle = "#0000FF";
      ctx.fillRect(x, y + 35, MARIO_WIDTH, 5);

      // –ë–æ—Ç–∏–Ω–∫–∏
      ctx.fillStyle = "#8B4513";
      const footWidth = 8, footHeight = 5;
      ctx.fillRect(x + 4, y + 39 + legOffset, footWidth, footHeight);
      ctx.fillRect(x + 18, y + 39 - legOffset, footWidth, footHeight);
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å —Ç—Ä–∞–≤–æ–π
    function drawPlatform(x, y, width) {
      const height = 20;
      // –ó–µ–º–ª—è
      ctx.fillStyle = "#8B4513";
      ctx.fillRect(x, y, width, height);
      // –¢—Ä–∞–≤–∞
      ctx.fillStyle = "#00AA00";
      ctx.fillRect(x, y, width, 5);
      // –¢—Ä–∞–≤–∏–Ω–∫–∏
      ctx.fillStyle = "#32CD32";
      for (let i = 0; i < width; i += 12) {
        ctx.fillRect(x + i, y - 2, 2, 4);
      }
    }

    // –û–±–ª–∞–∫–∞
    function drawCloud(x, y) {
      ctx.fillStyle = "rgba(255,255,255,0.95)";
      ctx.beginPath();
      ctx.arc(x, y, 15, 0, Math.PI * 2);
      ctx.arc(x + 12, y - 8, 18, 0, Math.PI * 2);
      ctx.arc(x + 28, y, 15, 0, Math.PI * 2);
      ctx.fill();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ú–∞—Ä–∏–æ
    function updateMario() {
      if (mario.isSpeaking) {
        mario.x += 2.5;
        if (mario.onGround) {
          mario.vy = JUMP_FORCE;
          mario.onGround = false;
        }
      }

      mario.vy += GRAVITY;
      mario.y += mario.vy;

      // –ù–∞ –∑–µ–º–ª–µ
      if (mario.y >= GROUND - MARIO_HEIGHT) {
        mario.y = GROUND - MARIO_HEIGHT;
        mario.vy = 0;
        mario.onGround = true;
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º
      mario.onGround = false;
      for (let p of platforms) {
        if (
          mario.x + MARIO_WIDTH > p.x &&
          mario.x < p.x + p.width &&
          mario.y + MARIO_HEIGHT <= p.y &&
          mario.y + MARIO_HEIGHT + mario.vy >= p.y
        ) {
          mario.y = p.y - MARIO_HEIGHT;
          mario.vy = 0;
          mario.onGround = true;
        }
      }

      // –ö–∞–º–µ—Ä–∞ —Å–ª–µ–¥—É–µ—Ç –∑–∞ –ú–∞—Ä–∏–æ
      if (mario.x - camera.x > canvas.width * 0.4) {
        camera.x = mario.x - canvas.width * 0.4;
      }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ–≥–æ
    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // –û–±–ª–∞–∫–∞ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ –¥–≤–∏–≥–∞—é—Ç—Å—è)
      drawCloud(200 - camera.x * 0.2, 60);
      drawCloud(600 - camera.x * 0.3, 100);
      drawCloud(1000 - camera.x * 0.25, 70);

      // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
      for (let p of platforms) {
        drawPlatform(p.x - camera.x, p.y, p.width);
      }

      // –ú–∞—Ä–∏–æ
      drawMario(mario.x - camera.x, mario.y);
    }

    // –ì–ª–∞–≤–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    function gameLoop() {
      addPlatforms();
      updateMario();
      render();
      requestAnimationFrame(gameLoop);
    }

    // –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
    function startSpeechRecognition() {
      if (!("webkitSpeechRecognition" in window) && !("SpeechRecognition" in window)) {
        statusText.innerHTML = "‚ùå –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏.<br>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome.";
        return;
      }

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.lang = "ru-RU";

      recognition.onstart = () => {
        statusText.textContent = "üé§ –ì–æ–≤–æ—Ä–∏—Ç–µ ‚Äî –ú–∞—Ä–∏–æ –±–µ–∂–∏—Ç!";
      };

      recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript.trim();
        if (transcript) {
          mario.isSpeaking = true;
          statusText.textContent = `üó£ "${transcript}" ‚Üí –ú–∞—Ä–∏–æ –ø—Ä—ã–≥–∞–µ—Ç!`;
          setTimeout(() => { mario.isSpeaking = false; }, 400);
        }
      };

      recognition.onerror = (event) => {
        if (event.error !== "no-speech") {
          console.warn("–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:", event.error);
        }
      };

      recognition.onend = () => {
        recognition.start(); // –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
      };

      recognition.start();
    }

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    initLevel();
    gameLoop();

    // –ó–∞–ø—É—Å–∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
    window.onload = () => {
      setTimeout(startSpeechRecognition, 1000);
    };
  </script>
</body>
</html>
